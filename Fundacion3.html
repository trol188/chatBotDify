<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Genesys Web Messenger – Launcher Custom</title>

  <script
    data-deployment-id="6a495972-d918-438f-a630-8dd1bb9fa6a3"
    data-environment="prod"
    data-avatar-url="https://img.icons8.com/external-outline-lafs/64/external-ic_support-menu-outline-lafs.png"
  >
  (function () {
    // ================= CONFIG =================
    const scriptTag = document.currentScript;

    const DEPLOYMENT_ID = scriptTag.dataset.deploymentId;
    const ENVIRONMENT   = scriptTag.dataset.environment || "prod";
    const AVATAR_URL    = scriptTag.dataset.avatarUrl || "";

    const WIDGET_ROOT_ID = "gcWidgetRoot";

    function onReady(fn) {
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", fn, { once: true });
      } else {
        fn();
      }
    }

    function waitBody(cb) {
      if (document.body) return cb();
      const i = setInterval(() => {
        if (document.body) {
          clearInterval(i);
          cb();
        }
      }, 50);
    }

    function waitGenesys(cb) {
      (function t() {
        if (window.Genesys) return cb();
        setTimeout(t, 100);
      })();
    }

    onReady(() => {
      waitBody(() => {
        if (document.getElementById(WIDGET_ROOT_ID)) return;

        // ================= CSS =================
        const style = document.createElement("style");
        style.textContent = `
          .gc-widget{position:fixed;right:22px;bottom:22px;z-index:999999;display:flex;flex-direction:column;align-items:flex-end;gap:10px;font-family:system-ui,Arial,sans-serif}
          .gc-bubble{position:relative;display:flex;align-items:center;gap:12px;padding:14px 18px 14px 14px;border-radius:999px;background:#8f847c;color:#fff;box-shadow:0 10px 22px rgba(0,0,0,.18)}
          .gc-bubble::after{content:"";position:absolute;right:22px;bottom:-10px;border-left:12px solid transparent;border-right:12px solid transparent;border-top:12px solid #8f847c}
          .gc-avatar{width:54px;height:54px;border-radius:50%;overflow:hidden;background:#fff}
          .gc-avatar img{width:100%;height:100%;object-fit:cover}
          .gc-title{font-weight:800;font-size:18px}
          .gc-sub{font-weight:600;font-size:14px}
          .gc-close{position:absolute;top:-10px;right:-10px;width:28px;height:28px;border-radius:50%;border:0;background:#2f2f2f;color:#fff;cursor:pointer}
          .gc-fab{width:72px;height:72px;border-radius:50%;border:0;background:#ff6a00;cursor:pointer;display:grid;place-items:center}
          .gc-hidden{display:none!important}
          .genesys-launcher,.cx-launcher{display:none!important}
        `;
        document.head.appendChild(style);

        // ================= HTML =================
        const root = document.createElement("div");
        root.id = WIDGET_ROOT_ID;
        root.innerHTML = `
          <div class="gc-widget">
            <div class="gc-bubble" id="gcBubble">
              <button class="gc-close" id="gcBubbleClose">×</button>
              <div class="gc-avatar">
                ${AVATAR_URL ? `<img src="${AVATAR_URL}" alt="Soporte">` : ""}
              </div>
              <div>
                <div class="gc-title">¿Necesita ayuda?</div>
                <div class="gc-sub">Nuestros ejecutivos están listos</div>
              </div>
            </div>

            <button class="gc-fab" id="gcFab">
              <svg viewBox="0 0 24 24" fill="white">
                <path d="M20 14c0 1.1-.9 2-2 2H9l-4 4V6c0-1.1.9-2 2-2h11c1.1 0 2 .9 2 2v8Z"/>
              </svg>
            </button>
          </div>
        `;
        document.body.appendChild(root);

        // ================= GENESYS =================
        (function (g, e, n, es, ys) {
          g["_genesysJs"] = e;
          g[e] = g[e] || function () { (g[e].q = g[e].q || []).push(arguments); };
          g[e].t = Date.now();
          g[e].c = es;

          ys = document.createElement("script");
          ys.async = true;
          ys.src = n;
          document.head.appendChild(ys);
        })(window, "Genesys", "https://apps.mypurecloud.com/genesys-bootstrap/genesys.min.js", {
          environment: ENVIRONMENT,
          deploymentId: DEPLOYMENT_ID
        });

        // ================= DATA DINÁMICA =================
        waitGenesys(() => {
          const nombreCompleto = document.body.textContent.trim();

          window.Genesys("command", "Database.set", {
            messaging: {
              customAttributes: {
                nombreCompleto,
                rut: "10777888-K",
                correo: "ssanchez@sercomed.cl"
              }
            }
          });
        });
      });
    });
  })();
  </script>
</head>

<body>
  Marco Antonio
</body>
</html>
